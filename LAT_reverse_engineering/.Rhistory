summarize(
number_of_payouts=n(),
total_amount=sum(amount)
) %>%
arrange(desc(total_amount))
top_cases %>%
slice_tail(n=3)
top_cases<-payouts %>%
filter(fiscal_year==2017) %>%
group_by(claim_number_case_number,case_name) %>%
summarize(
number_of_payouts=n(),
total_amount=sum(amount)
) %>%
arrange(desc(total_amount))
top_cases
top_cases<-payouts %>%
filter(fiscal_year==2017) %>%
group_by(claim_number_case_number,case_name) %>%
summarize(
number_of_payouts=n(),
total_amount=sum(amount)
) %>%
arrange(desc(total_amount))
top_cases %>%
slice_head(n=3)
top_cases<-payouts %>%
filter(fiscal_year==2017) %>%
group_by(claim_number_case_number,case_name) %>%
summarize(
number_of_payouts=n(),
total_amount=sum(amount)
) %>%
arrange(desc(total_amount))
top_cases<-payouts %>%
filter(fiscal_year==2017) %>%
group_by(claim_number_case_number,case_name) %>%
summarize(
number_of_payouts=n(),
total_amount=sum(amount)
) %>%
arrange(desc(total_amount)) %>%
top_cases %>%
slice_head(top_cases,n=3)
top_cases<-payouts %>%
filter(fiscal_year==2017) %>%
group_by(claim_number_case_number,case_name) %>%
summarize(
number_of_payouts=n(),
total_amount=sum(amount)
) %>%
arrange(desc(total_amount)) %>%
top_cases %>%
slice_head(total_amount,n=3)
top_cases<-payouts %>%
filter(fiscal_year==2017) %>%
group_by(claim_number_case_number,case_name) %>%
summarize(
number_of_payouts=n(),
total_amount=sum(amount)
) %>%
arrange(desc(total_amount))
top_cases %>%
slice_head(total_amount,n=3)
top_cases<-payouts %>%
filter(fiscal_year==2017) %>%
group_by(claim_number_case_number,case_name) %>%
summarize(
number_of_payouts=n(),
total_amount=sum(amount)
) %>%
arrange(desc(total_amount))
top_cases %>%
slice_head(n=3)
View(top_cases)
top_cases<-payouts %>%
filter(fiscal_year==2017) %>%
group_by(claim_number_case_number,case_name) %>%
summarize(
number_of_payouts=n(),
total_amount=sum(amount)
) %>%
arrange(desc(total_amount))
top_cases<-top_cases %>%
slice_head(n=3)
View(top_cases)
top_cases<-payouts %>%
filter(fiscal_year==2017) %>%
group_by(claim_number_case_number,case_name) %>%
summarize(
number_of_payouts=n(),
total_amount=sum(amount)
) %>%
arrange(desc(total_amount))
top_cases<-top_cases %>%
slice_head(n=3)
View(top_cases)
top_cases<-payouts %>%
filter(fiscal_year==2017) %>%
group_by(claim_number_case_number,case_name) %>%
summarize(
number_of_payouts=n(),
total_amount=sum(amount)
) %>%
arrange(desc(total_amount))
top_cases2<-top_cases %>%
slice_head(n=3)
View(top_cases2)
top_cases<-payouts %>%
filter(fiscal_year==2017) %>%
group_by(claim_number_case_number,case_name) %>%
summarize(
number_of_payouts=n(),
total_amount=sum(amount)
) %>%
arrange(desc(total_amount))
top_cases<-payouts %>%
filter(fiscal_year==2017) %>%
group_by(claim_number_case_number,case_name) %>%
summarize(
number_of_payouts=n(),
total_amount=sum(amount)
) %>%
arrange(desc(total_amount))
top_cases2<-top_cases %>%
slice_head(n=3)
top_cases<-payouts %>%
filter(fiscal_year==2017) %>%
group_by(claim_number_case_number,case_name) %>%
summarize(
number_of_payouts=n(),
total_amount=sum(amount)
) %>%
arrange(desc(total_amount)) %>%
slice_head(n=3)
top_cases<-payouts %>%
filter(fiscal_year==2017) %>%
group_by(claim_number_case_number,case_name) %>%
summarize(
number_of_payouts=n(),
total_amount=sum(amount)
) %>%
arrange(desc(total_amount)) %>%
slice_head(n=10)
knitr::opts_chunk$set(echo = TRUE)
options(scipen=999)
library(tidyverse)
library(rio)
library(lubridate)
library(janitor)
#import data function
payouts <- rio::import('payouts.xlsx',
skip=1, header=TRUE)
#The above skip/header functions deletes the wonky top row, make the second row into headers
payouts <- payouts %>%
slice_head(n=18701) %>%
clean_names()
#rsw comment: your method works, but I would just name the offending rows and chainsaw them:
#  |>
#   slice(-c(18702, 18703))
#the bottom two rows in the csv are one blank row and then a row with a grand total, this will screw up the data. Slice_head means filtering by that number of rows, I tried to use slice_tail(n=2) but it gave me JUST the bottom two rows, so I did total rows minus 2 and slice_head.
##Note to RW if you have a suggestion on a more succinct/elegant way to achieve the above function please let us know
#Import function for department totals which was brought into DAVIDS section from BEX's code to load department totals from comparison was deleted because it was from the output folder rather than the input folder.
yearly_data_sum <- payouts %>%
group_by(fiscal_year) %>%
summarise(
total_cases = n(),
total_amount = sum(amount, na.rm = TRUE)
) %>%
arrange(fiscal_year)
# Check 2017 total (last budget year when article was published in 2018)
yearly_data_sum %>%
filter(fiscal_year == 2017)
yearly_data_sum <- payouts %>%
group_by(fiscal_year) %>%
summarise(
total_cases = n(),
total_amount = sum(amount, na.rm = TRUE),
average_payout = mean(amount, na.rm=TRUE),
#then filter the rows in the source table to rows with the amount column has a value over 1 million then count how many rows each fiscal_year value has that meet that condition for a column in the pivot table
number_of_cases_over_one_million = sum(amount >= 1000000, na.rm=TRUE)
) %>%
arrange(fiscal_year)
#variables in this section changed to match dataframe names established by Bex
yearly_data_sum %>%
mutate(
pct_change_from_baseline = ((total_cases - first(total_cases))/
first(total_cases)) * 100,
difference_from_baseline = total_cases - first(total_cases)
) %>%
select(fiscal_year, total_cases, difference_from_baseline, pct_change_from_baseline)
#NOTE TO RW: trends difference from article suggest missing data cleaning step, search "DATA CLEANING INVESTIGATION" in this code for what I'd like your thoughts on
#NOTE TO RW: Is the difference from baseline and pct change from baseline helpful? Or would you recommend changing it to year to year difference/pct change?
yearly_data_sum %>%
mutate(
pct_change_from_baseline = ((average_payout - first(average_payout))/first(average_payout)) * 100,
difference_from_baseline = average_payout - first(average_payout)
) %>%
select(fiscal_year, average_payout, difference_from_baseline, pct_change_from_baseline)
yearly_data_sum %>%
filter(fiscal_year == 2017) %>%
select(fiscal_year, number_of_cases_over_one_million)
yearly_data_sum %>%
filter(fiscal_year == 2007 | fiscal_year == 2017) %>%
mutate(decade_change_multiplier = number_of_cases_over_one_million/
first(number_of_cases_over_one_million)) %>%
select(fiscal_year, number_of_cases_over_one_million, decade_change_multiplier)
#NOTE TO RW: For clarity's sake should I remove the "Decade cahnge multiplier" because maybe it implies that 2007 was the same as 1997. And instead just do a math operation outside the dataframe.
#Note to RW, you said you didn't understand the Decade Change Multiplier. Its just saying there were 5 times as many cases in 2017 than there were 10 years before. 30/6=5, thats all.
#not sure what else to call it can someone take a crack at this
lapd_cases <- payouts |>
mutate(department=str_to_upper(department)) %>%
filter(str_detect(department, 'POLICE'))
lapd_cases |>
arrange(desc(amount))
department_totals <- payouts |>
mutate(department=str_to_upper(department)) %>%
group_by(department) |>
summarise(
total_cases = n(),
total_amount = sum(amount, na.rm = TRUE)
) |>
arrange(desc(total_amount))
department_totals
# Geting total for all departments
overall_total <- sum(payouts$amount, na.rm = TRUE)
# Calculating LAPD totals and percentage
lapd_summary <- department_totals |>
filter(str_detect(department, 'POLICE')) |>
summarise(
total_lapd_cases = sum(total_cases),
total_lapd_amount = sum(total_amount),
percentage_of_total = (sum(total_amount) / overall_total) * 100
)
lapd_summary
# Show top 10 departments by payout amount
department_totals |>
mutate(percentage_of_total = (total_amount / overall_total) * 100) |>
arrange(desc(total_amount))
# total LAPD cases by year
lapd_cases |>
group_by(fiscal_year) |>
summarise(
cases = n(),
total_amount = sum(amount, na.rm = TRUE)
) |>
arrange(fiscal_year)
#David Note: separately, pulling total cases from department totals, calculated in finding 3.1 code chunk
department_totals %>%
filter(department=="Police Department")
false_imprisonment_cases <- lapd_cases %>%
filter(str_detect(case_type, 'False Arrest/Detention/Imprisonment')) |>
arrange(desc(amount))
top_cases<-payouts %>%
filter(fiscal_year==2017) %>%
group_by(claim_number_case_number,case_name) %>%
summarize(
number_of_payouts=n(),
total_amount=sum(amount)
) %>%
arrange(desc(total_amount)) %>%
slice_head(n=10)
top_cases<-payouts %>%
filter(fiscal_year==2017) %>%
group_by(claim_number_case_number,case_name) %>%
summarize(
number_of_payouts=n(),
total_amount=sum(amount)
) %>%
arrange(desc(total_amount))
top_cases<-payouts %>%
filter(fiscal_year==2017) %>%
group_by(claim_number_case_number,case_name) %>%
summarize(
number_of_payouts=n(),
total_amount=sum(amount)
) %>%
arrange(desc(total_amount))
top_cases %>%
slice_head(n=2)
top_cases<-payouts %>%
filter(fiscal_year==2017) %>%
group_by(claim_number_case_number,case_name) %>%
summarize(
number_of_payouts=n(),
total_amount=sum(amount)
) %>%
arrange(desc(total_amount))
top_cases %>%
slice_head(n=3)
top_cases<-payouts %>%
filter(fiscal_year==2017) %>%
group_by(claim_number_case_number,case_name) %>%
summarize(
number_of_payouts=n(),
total_amount=sum(amount)
) %>%
arrange(desc(total_amount))
top_cases %>%
slice_head(n=200)
knitr::opts_chunk$set(echo = TRUE)
options(scipen=999)
library(tidyverse)
library(rio)
library(lubridate)
library(janitor)
#import data function
payouts <- rio::import('payouts.xlsx',
skip=1, header=TRUE)
#The above skip/header functions deletes the wonky top row, make the second row into headers
payouts <- payouts %>%
slice_head(n=18701) %>%
clean_names()
#rsw comment: your method works, but I would just name the offending rows and chainsaw them:
#  |>
#   slice(-c(18702, 18703))
#the bottom two rows in the csv are one blank row and then a row with a grand total, this will screw up the data. Slice_head means filtering by that number of rows, I tried to use slice_tail(n=2) but it gave me JUST the bottom two rows, so I did total rows minus 2 and slice_head.
##Note to RW if you have a suggestion on a more succinct/elegant way to achieve the above function please let us know
#Import function for department totals which was brought into DAVIDS section from BEX's code to load department totals from comparison was deleted because it was from the output folder rather than the input folder.
yearly_data_sum <- payouts %>%
group_by(fiscal_year) %>%
summarise(
total_cases = n(),
total_amount = sum(amount, na.rm = TRUE)
) %>%
arrange(fiscal_year)
# Check 2017 total (last budget year when article was published in 2018)
yearly_data_sum %>%
filter(fiscal_year == 2017)
yearly_data_sum <- payouts %>%
group_by(fiscal_year) %>%
summarise(
total_cases = n(),
total_amount = sum(amount, na.rm = TRUE),
average_payout = mean(amount, na.rm=TRUE),
#then filter the rows in the source table to rows with the amount column has a value over 1 million then count how many rows each fiscal_year value has that meet that condition for a column in the pivot table
number_of_cases_over_one_million = sum(amount >= 1000000, na.rm=TRUE)
) %>%
arrange(fiscal_year)
#variables in this section changed to match dataframe names established by Bex
yearly_data_sum %>%
mutate(
pct_change_from_baseline = ((total_cases - first(total_cases))/
first(total_cases)) * 100,
difference_from_baseline = total_cases - first(total_cases)
) %>%
select(fiscal_year, total_cases, difference_from_baseline, pct_change_from_baseline)
#NOTE TO RW: trends difference from article suggest missing data cleaning step, search "DATA CLEANING INVESTIGATION" in this code for what I'd like your thoughts on
#NOTE TO RW: Is the difference from baseline and pct change from baseline helpful? Or would you recommend changing it to year to year difference/pct change?
yearly_data_sum %>%
mutate(
pct_change_from_baseline = ((average_payout - first(average_payout))/first(average_payout)) * 100,
difference_from_baseline = average_payout - first(average_payout)
) %>%
select(fiscal_year, average_payout, difference_from_baseline, pct_change_from_baseline)
yearly_data_sum %>%
filter(fiscal_year == 2017) %>%
select(fiscal_year, number_of_cases_over_one_million)
yearly_data_sum %>%
filter(fiscal_year == 2007 | fiscal_year == 2017) %>%
mutate(decade_change_multiplier = number_of_cases_over_one_million/
first(number_of_cases_over_one_million)) %>%
select(fiscal_year, number_of_cases_over_one_million, decade_change_multiplier)
#NOTE TO RW: For clarity's sake should I remove the "Decade cahnge multiplier" because maybe it implies that 2007 was the same as 1997. And instead just do a math operation outside the dataframe.
#Note to RW, you said you didn't understand the Decade Change Multiplier. Its just saying there were 5 times as many cases in 2017 than there were 10 years before. 30/6=5, thats all.
#not sure what else to call it can someone take a crack at this
lapd_cases <- payouts |>
mutate(department=str_to_upper(department)) %>%
filter(str_detect(department, 'POLICE'))
lapd_cases |>
arrange(desc(amount))
department_totals <- payouts |>
mutate(department=str_to_upper(department)) %>%
group_by(department) |>
summarise(
total_cases = n(),
total_amount = sum(amount, na.rm = TRUE)
) |>
arrange(desc(total_amount))
department_totals
# Geting total for all departments
overall_total <- sum(payouts$amount, na.rm = TRUE)
# Calculating LAPD totals and percentage
lapd_summary <- department_totals |>
filter(str_detect(department, 'POLICE')) |>
summarise(
total_lapd_cases = sum(total_cases),
total_lapd_amount = sum(total_amount),
percentage_of_total = (sum(total_amount) / overall_total) * 100
)
lapd_summary
# Show top 10 departments by payout amount
department_totals |>
mutate(percentage_of_total = (total_amount / overall_total) * 100) |>
arrange(desc(total_amount))
# total LAPD cases by year
lapd_cases |>
group_by(fiscal_year) |>
summarise(
cases = n(),
total_amount = sum(amount, na.rm = TRUE)
) |>
arrange(fiscal_year)
#David Note: separately, pulling total cases from department totals, calculated in finding 3.1 code chunk
department_totals %>%
filter(department=="Police Department")
false_imprisonment_cases <- lapd_cases %>%
filter(str_detect(case_type, 'False Arrest/Detention/Imprisonment')) |>
arrange(desc(amount))
top_cases<-payouts %>%
filter(fiscal_year==2017) %>%
group_by(claim_number_case_number,case_name) %>%
summarize(
number_of_payouts=n(),
total_amount=sum(amount)
) %>%
arrange(desc(total_amount))
top_cases %>%
slice_head(n=200)
top_cases<-payouts %>%
filter(fiscal_year==2017) %>%
group_by(claim_number_case_number,case_name) %>%
summarize(
number_of_payouts=n(),
total_amount=sum(amount)
) %>%
arrange(desc(total_amount))
top_cases %>%
slice_head(n=2
top_cases<-payouts %>%
filter(fiscal_year==2017) %>%
group_by(claim_number_case_number,case_name) %>%
summarize(
number_of_payouts=n(),
total_amount=sum(amount)
) %>%
arrange(desc(total_amount))
top_cases %>%
slice_head(n=2)
top_cases<-payouts %>%
filter(fiscal_year==2017) %>%
group_by(claim_number_case_number,case_name) %>%
summarize(
number_of_payouts=n(),
total_amount=sum(amount)
) %>%
arrange(desc(total_amount))
first(top_cases)
top_cases<-payouts %>%
filter(fiscal_year==2017) %>%
group_by(claim_number_case_number,case_name) %>%
summarize(
number_of_payouts=n(),
total_amount=sum(amount)
) %>%
arrange(desc(total_amount))
slice_head(top_cases,n=3)
top_cases<-payouts %>%
filter(fiscal_year==2017) %>%
group_by(claim_number_case_number,case_name) %>%
summarize(
number_of_payouts=n(),
total_amount=sum(amount)
) %>%
arrange(desc(total_amount))
View(top_cases)
top_cases<-payouts %>%
filter(fiscal_year==2017) %>%
group_by(claim_number_case_number,case_name) %>%
summarize(
number_of_payouts=n(),
total_amount=sum(amount)
) %>%
arrange(desc(total_amount))
top_cases %>%
slice_head(n=3)
top_cases<-payouts %>%
filter(fiscal_year==2017) %>%
group_by(claim_number_case_number,case_name) %>%
summarize(
number_of_payouts=n(),
total_amount=sum(amount)
) %>%
arrange(desc(total_amount)) %>%
ungroup() %>%
arrange(desc(total_amount)) %>%
slice_head(n=3)
View(top_cases)
View(payouts)
top_cases<-payouts %>%
filter(fiscal_year==2017) %>%
group_by(claim_number_case_number,case_name,department,case_type) %>%
summarize(
number_of_payouts=n(),
total_amount=sum(amount)
) %>%
arrange(desc(total_amount)) %>%
ungroup() %>%
arrange(desc(total_amount)) %>%
slice_head(n=3)
View(top_cases)
payouts %>%
filter(fiscal_year==2017) %>%
group_by(claim_number_case_number,case_name,department,case_type) %>%
summarize(
number_of_payouts=n(),
total_amount=sum(amount)
) %>%
arrange(desc(total_amount)) %>%
ungroup() %>%
arrange(desc(total_amount)) %>%
slice_head(n=3)
